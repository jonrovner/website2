<html>
    <head>
        <title>Jonrovner frontend</title>    
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <style type = "text/css" media = "all">

        body{
            border: 1px solid black;
            margin: 0px;
            padding: 0px;
        }
        .infotext {
            font-style: italic;
            font-weight: lighter;
            margin-left: 2em;
        }
        

        .title{
            margin-left:12em;
        }
        .week{
            margin-top: 2em;;
            margin-left: 2em;
            margin-right: 2em;
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            grid-template-rows: 25px 50px 50px; 
            row-gap: 1px;
            column-gap: 1px;
            
        }    
        .menu{
            margin: 1em;
            display: grid;
            grid-template-columns: 100px 100px 100px 100px 100px 100px;
            grid-template-rows: 50px 50px;
            row-gap: 1px;
            column-gap: 1px;
            border: 1px solid black
        }
        .item {
            border: 1px solid black;
            margin: 1px;
            display: grid;
            align-content: center;
            justify-content: center;
            cursor: move;
        }

        .selected {
            border: 2px solid red;
        }
        .main:hover {
            background-color: pink;
        }
        .addDishes {
            border: 1px solid black;
            margin-left: 3em;
            margin-right: 3em;

        }
        .selected {
            background-color: lightcyan;
        }
        
        .ingredients{
            margin: 5px;
            border: 1px solid black;
            min-height: 2em;
        }
        .ingredientsList{
           
            display: none;
            position: relative;
            background-color: #f1f1f1;
            min-width: 160px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            
        }
        .item:hover .ingredientsList {
            display: block;
            position: fixed;
            bottom: 10px;
            right: 10px;
            border: 1px solid black;
            
        
        }
        .item:hover .ingredientsList * {
            margin-left: 1em;
        }
        .maincontainer{
            margin: 1em;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            border: 1px solid black;
        }

        #shoppingList{
            min-height: 50px;
            margin: 1em;
            border: 1px solid black;
        }


        </style>
    
    <body onload="">
       <div id="wrapper"> 
        <header>
            <h1 class="title">Menu Semanal</h1>
        </header>
        <nav>
           
        </nav>
        <main>   
            <div class="container week">
                <div class="item"></div>
                <div class="item">lunes</div>
                <div class="item">martes</div>
                <div class="item">miercoles</div>
                <div class="item">jueves</div>
                <div class="item">viernes</div>
                <div class="item">sabado</div>
                <div class="item">domingo</div>
                <div class="item">almuerzo</div>
                <div class="item main" id="main1" onclick="handleWeekClick(this)" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                <div class="item main" id="main2" onclick="handleWeekClick(this)" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                <div class="item main" id="main3" onclick="handleWeekClick(this)" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                <div class="item main" id="main4" onclick="handleWeekClick(this)" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                <div class="item main" id="main5" onclick="handleWeekClick(this)" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                <div class="item main" id="main6" onclick="handleWeekClick(this)" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                <div class="item main" id="main7" onclick="handleWeekClick(this)" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                <div class="item">cena</div>
                <div class="item main" id="main8" onclick="handleWeekClick(this)" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                <div class="item main" id="main9" onclick="handleWeekClick(this)" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                <div class="item main" id="main10" onclick="handleWeekClick(this)" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                <div class="item main" id="main11" onclick="handleWeekClick(this)" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                <div class="item main" id="main12" onclick="handleWeekClick(this)" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                <div class="item main" id="main13" onclick="handleWeekClick(this)" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                <div class="item main" id="main14" onclick="handleWeekClick(this)" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                
            
            </div>
            <p class="infotext">Arrastra la comida seleccionada a los casilleros en blanco, click en el casillero para borrar su contenido</p>
            <div class="maincontainer">
            <div class="container menu" id="menu">
            </div>
            <div id="shoppingListContainer">shopping list:<div id="shoppingList"></div>
            </div>
            </div>
            <p class="infotext">completa la lista de ingredientes, el nombre del plato y apreta "agregar"</p>
            <form class="addDishes">
                plato: <input type="text" name="item" placeholder="new dish?" required>
                ingredientes: <input type="text" name="ingredient" placeholder="add ingredient" required>
                <button id="addIngredient">+</button>
                <div class="ingredients" id="ingredientsToAdd"></div>
                <button id="newDish">AGREGAR</button>
            </form>

        </main>

        </div>  


    <script>
        var thingToDrag = "";
        var ingredientsToAdd = [];
        var ingredientsToShop = [];
        
        let defaultDishes = [
                        {name: "tarta",
                        ingredients: [
                                    "masa pascualina", 
                                    "huevos", 
                                    "manteca", 
                                    "espinaca", 
                                    "queso"]
                        },
                        {name: "empanads",
                        ingredients: [
                                    "tapas empanadas", 
                                    "lata atun", 
                                    "papas", 
                                    "cebollas"]
                        },
                        {name:"arroz cubana",
                        ingredients: [
                                      "arroz",
                                      "banana",
                                      "huevos",
                                      "salchichas"]
                        },
                        {name:"fideos",
                        ingredients: [
                                      "fideos",
                                      "lata tomate",
                                      "queso rallado"
                        ]},
                        ];
                        
        function getDishes(){
            if (localStorage.getItem("dishes")===null){
            return defaultDishes.slice();
            }      
            return JSON.parse(localStorage.getItem("dishes"));   
        
      }
     
        function populateMenu() {
            const dishes = getDishes();         
            dishes.forEach(function(dish) {
                var dis = dish.name
                var ings = dish.ingredients;
                var food = document.createElement("div");
                food.classList.add("item");
                food.innerHTML = "<p draggable=\"true\" ondragstart=\"drag(this)\">"+dis+"</p><div class=\"ingredientsList\" id=\""+dis+"\"></div>";
                document.getElementById("menu").appendChild(food);
                ings.forEach(function(i){
                    var ing = document.createElement("p");
                    ing.innerHTML = i+" ";
                    document.getElementById(dis).appendChild(ing); 
                });  
                }
                
            );
            localStorage.setItem("dishes", JSON.stringify(dishes));
        }

        function handleWeekClick(e){
        
        if (e.innerHTML !== ""){
            e.innerHTML = "";
        }
      }
      
        function allowDrop(e) {
            e.preventDefault();
            }

        function drag(e) {
            thingToDrag = e.innerHTML
            var dishes = JSON.parse(localStorage.getItem("dishes"));
            var x = search(e.textContent, dishes);
            var arr = x.ingredients;
            arr.forEach((e) => ingredientsToAdd.push(e));
        }

        function search(nameKey, myArray){
                for (var i=0; i < myArray.length; i++) {
                    if (myArray[i].name === nameKey) {
                    return myArray[i];
                    }
                }
            }

        function drop(e) {
            e.preventDefault();
            document.getElementById(e.target.id).innerHTML = thingToDrag;
            ingredientsToAdd.forEach((i) => ingredientsToShop.push(i));
            ingredientsToAdd = [];
            let unique = [...new Set(ingredientsToShop)];
            document.querySelector("#shoppingList").innerHTML = unique.join(", ");
            }

        function addIngredient(e){
          e.preventDefault();
          const ingredient = (document.querySelector('[name=ingredient]')).value;
          ingredientsToAdd.push(ingredient);
          var ing = document.createElement("p");
          ing.innerHTML = ingredient;
          document.getElementById("ingredientsToAdd").appendChild(ing);
         
        }

        function addDish(e){
          e.preventDefault();
          let objectToadd = {
              name: (document.querySelector('[name=item]')).value,
              ingredients:ingredientsToAdd
          }    
          var dis = JSON.parse(localStorage.getItem("dishes"));
          dis.push(objectToadd);
          localStorage.setItem("dishes", JSON.stringify(dis));
          document.getElementById("menu").innerHTML = "";
          populateMenu();
          document.getElementById("ingredientsToAdd").innerHTML = "";
          ingredientsToAdd = [];
        }

        document.getElementById("addIngredient").addEventListener('click', addIngredient);
        document.getElementById("newDish").addEventListener('click', addDish)
        populateMenu();
      
    </script>    
    </body>
    