<html>
    <head>
        <title>my meal planner</title>    
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <style type = "text/css" media = "all">

        body{
            
            
            margin: 0px;
            padding: 0px;
        }

        body::after{
                    content: "";
                    background: url(food.png);
                    background-size: 20px;
                    background-repeat: repeat;
                    opacity: 0.02;
                    top: 0;
                    left: 0;
                    bottom: 0;
                    right: 0;
                    position: absolute;
                    z-index: -1;   
        }
        
        .infotext {
            font-style: italic;
            font-weight: lighter;
            margin-left: 2em;
        }
        

        .title{
            font-family: Arial;
            font-size: smaller;
            margin-left:2em;
        }
        .week{
            margin-top: 2em;;
            margin-left: 2em;
            margin-right: 2em;
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            grid-template-rows: 25px 50px 50px; 
            row-gap: 1px;
            column-gap: 1px;
            
        }    
        .menu{
            margin: 1em;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: 50px 50px;
            row-gap: 1px;
            column-gap: 1px;
            
        }
        .item {
            background-color: mistyrose;
            border: 1px dotted lightcyan;
            margin: 1px;
            font-family: arial;
            font-weight: bold;
            border-radius: 1em;
            display: grid;
            align-content: center;
            justify-content: center;
            cursor: move;
        }

        .selected {
            border: 2px solid red;
        }
        .main:hover {
            background-color: pink;
        }
        .addDishes {
            border: 1px solid black;
            margin-left: 3em;
            margin-right: 3em;

        }
        .selected {
            background-color: lightcyan;
        }
        
        .ingredients{
            margin: 5px;
            border: 1px solid black;
            min-height: 2em;
        }
        .ingredientsList{
           
            display: none;
            position: relative;
            background-color: #f1f1f1;
            min-width: 160px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            
        }
        .item:hover .ingredientsList {
            
            display: block;
            position: fixed;
            bottom: 100px;
            right: 100px;
            border: 1px solid black;
            
        
        }
        .item:hover .ingredientsList * {
            margin-left: 1em;
        }
        .maincontainer{
            margin: 0.5em;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            
        }

        #shoppingList{
            background-color: whitesmoke;
            min-height: 100px;
            margin: 0.5em;
            
        }


        </style> 
    <body onload="">
       <div id="wrapper"> 
        <header>
            <h1 class="title">My Weekly Meal Planner</h1>
        </header>
        <nav>
           
        </nav>
        <main>   
            <div class="container week">
                <div class="item" style="visibility: hidden;"></div>
                <div class="item">Monday</div>
                <div class="item">Tuesday</div>
                <div class="item">Wednesday</div>
                <div class="item">Thursday</div>
                <div class="item">Friday</div>
                <div class="item">Saturday</div>
                <div class="item">Sunday</div>
                <div class="item">Lunch</div>
                <div class="item main" id="main1" onclick="handleWeekClick(this)" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                <div class="item main" id="main2" onclick="handleWeekClick(this)" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                <div class="item main" id="main3" onclick="handleWeekClick(this)" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                <div class="item main" id="main4" onclick="handleWeekClick(this)" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                <div class="item main" id="main5" onclick="handleWeekClick(this)" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                <div class="item main" id="main6" onclick="handleWeekClick(this)" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                <div class="item main" id="main7" onclick="handleWeekClick(this)" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                <div class="item">Dinner</div>
                <div class="item main" id="main8" onclick="handleWeekClick(this)" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                <div class="item main" id="main9" onclick="handleWeekClick(this)" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                <div class="item main" id="main10" onclick="handleWeekClick(this)" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                <div class="item main" id="main11" onclick="handleWeekClick(this)" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                <div class="item main" id="main12" onclick="handleWeekClick(this)" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                <div class="item main" id="main13" onclick="handleWeekClick(this)" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                <div class="item main" id="main14" onclick="handleWeekClick(this)" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                
            
            </div>
            <p class="infotext">Drag dishes into calendar. Click on added dishes to delete them</p>
            <div class="maincontainer">
            <div class="container menu" id="menu">
            </div>
            <div id="shoppingListContainer">shopping list:<div id="shoppingList"></div>
            </div>
            </div>
            <p class="infotext">Complete the ingredient list, the dish name, and hit on add button</p>
            <form class="addDishes">
                Dish name: <input type="text" name="item" placeholder="new dish?" required>
                Ingredients: <input type="text" name="ingredient" placeholder="add ingredient" required>
                <button id="addIngredient">+</button>
                <div class="ingredients" id="ingredientsToAdd"></div>
                <button id="newDish">ADD</button>
            </form>

        </main>

        </div>  


    <script>
        var thingToDrag = "";
        var ingredientsToAdd = [];
        var ingredientsToShop = [];
        
        let defaultDishes = [
                        {name: "Falafel",
                        ingredients: [
                                    "cheekpeas", 
                                    "persil", 
                                    "coriander", 
                                    "pita bread", 
                                    "yoghurt sauce"]
                        },
                        {name: "empanadas",
                        ingredients: [
                                    "dough", 
                                    "tuna", 
                                    "potatoes", 
                                    "onions",
                                    "olives"]
                        },
                        {name:"cuban rice",
                        ingredients: [
                                      "rice",
                                      "bananas",
                                      "eggs",
                                      "sausages"]
                        },
                        {name:"pasta",
                        ingredients: [
                                      "noodles",
                                      "tomatoes",
                                      "garlic",
                                      "cheese"
                        ]},
                        ];
                        
        function getDishes(){
            if (localStorage.getItem("dishes")===null){
            return defaultDishes.slice();
            }      
            return JSON.parse(localStorage.getItem("dishes"));   
        
      }
     
        function populateMenu() {
            const dishes = getDishes();         
            dishes.forEach(function(d) {
                var dish = d.name
                var ings = d.ingredients;
                var food = document.createElement("div");
                food.classList.add("item");
                food.innerHTML = "<p draggable=\"true\" ondragstart=\"drag(this)\">"+dish+"</p><div class=\"ingredientsList\" id=\""+dish+"\"></div>";
                document.getElementById("menu").appendChild(food);
                ings.forEach(function(i){
                    var ing = document.createElement("p");
                    ing.innerHTML = i+" ";
                    document.getElementById(dish).appendChild(ing); 
                });  
                }
                
            );
            localStorage.setItem("dishes", JSON.stringify(dishes));
        }

        function handleWeekClick(e){
            const content = e.textContent;
            var dishes = JSON.parse(localStorage.getItem("dishes"));
            var x = search(e.textContent, dishes);
            var arr = x.ingredients;
            arr.forEach((e) => {
                for( var i = 0; i < ingredientsToShop.length; i++)
                { if ( ingredientsToShop[i] === e) { ingredientsToShop.splice(i, 1); }}
            });
            let unique = [...new Set(ingredientsToShop)];
            document.querySelector("#shoppingList").innerHTML = unique.join(", ");

        
        if (e.innerHTML !== ""){
            e.innerHTML = "";
        }
      }
      
        function allowDrop(e) {
            e.preventDefault();
            }

        function drag(e) {
            thingToDrag = e.innerHTML
            var dishes = JSON.parse(localStorage.getItem("dishes"));
            var x = search(e.textContent, dishes);
            var arr = x.ingredients;
            arr.forEach((e) => ingredientsToAdd.push(e));
        }

        function search(nameKey, myArray){
                for (var i=0; i < myArray.length; i++) {
                    if (myArray[i].name === nameKey) {
                    return myArray[i];
                    }
                }
            }

        function drop(e) {
            e.preventDefault();
            document.getElementById(e.target.id).innerHTML = thingToDrag;
            ingredientsToAdd.forEach((i) => ingredientsToShop.push(i));
            ingredientsToAdd = [];
            let unique = [...new Set(ingredientsToShop)];
            document.querySelector("#shoppingList").innerHTML = unique.join(", ");
            }

        function addIngredient(e){
          e.preventDefault();
          const ingredient = (document.querySelector('[name=ingredient]')).value;
          ingredientsToAdd.push(ingredient);
          var ing = document.createElement("p");
          ing.innerHTML = ingredient;
          document.getElementById("ingredientsToAdd").appendChild(ing);
         
        }

        function addDish(e){
          e.preventDefault();
          let objectToadd = {
              name: (document.querySelector('[name=item]')).value,
              ingredients:ingredientsToAdd
          }    
          var dis = JSON.parse(localStorage.getItem("dishes"));
          dis.push(objectToadd);
          localStorage.setItem("dishes", JSON.stringify(dis));
          document.getElementById("menu").innerHTML = "";
          populateMenu();
          document.getElementById("ingredientsToAdd").innerHTML = "";
          ingredientsToAdd = [];
        }

        document.getElementById("addIngredient").addEventListener('click', addIngredient);
        document.getElementById("newDish").addEventListener('click', addDish)
        populateMenu();
      
    </script>    
    </body>
    