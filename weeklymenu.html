<html>
    <head>
        <title>what we eat</title>    
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Amatic+SC:wght@700&family=Open+Sans:wght@300&display=swap" rel="stylesheet"> 
        <style type = "text/css" media = "all">

        body{
            box-sizing: border-box;
            margin: 0px;
            padding: 0px;
        }
 
        .infotext {
            font-family: 'Open Sans', sans-serif;
            font-style: italic;
            font-weight: lighter;
            margin-left: 2em;
        }
        

        .title{
            display: grid;
            font-family: 'Amatic SC', cursive;
            margin: 2em;
            
            justify-items: center;
            align-items: center;
        }
        .week{
            margin-left: 2em;
            margin-right: 2em;
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            grid-template-rows: 25px 50px 50px; 
            row-gap: 1px;
            column-gap: 1px;
            
        }    
        .menu{
            margin: 1em;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: auto;
            row-gap: 1em;
            column-gap: 1em;
            
        }
        .item {
            position: relative;
            font-family: 'Amatic SC', cursive;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.2), 0 2px 5px 0 rgba(0, 0, 0, 0.19);
           
            border-radius: 0.1em;
            display: grid;
            align-content: center;
            justify-content: center;
            cursor: move;
        }

        .item p {
            padding: 5px;
            background-color:black;
            color: blanchedalmond;
        }

        .centered {
            position: absolute;
            top: 25%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1;
}

        .selected {
            border: 2px solid red;
        }
        .main:hover {
            background-color: pink;
        }
        .addDishes {
           background-color: cornsilk;
            margin: 1em;

        }
        .selected {
            background-color: lightcyan;
        }
        
        .ingredients{
            background-color: blanchedalmond;
            margin: 5px;
            min-height: 2em;
        }
        .ingredientsList{
            margin-left: 1em;
           font-family: Arial, Helvetica, sans-serif;
           font-style: italic;
           font-size: smaller;
            position: relative;
            background-color: #f1f1f1;
            min-width: 160px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            
        }
        
        .maincontainer{
            margin: 0.5em;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            
        }

        #shoppingList{
            background-color: whitesmoke;
            min-height: 100px;
            margin: 0.5em;
            
        }

        #addNewDishForm{
            display: none;
        } 

        #addNewDishForm .visible {
            display: block;
        }


        </style> 
    <body onload="">
       <div id="wrapper"> 
        <header>
            <h1 class="title">WhatWeEater</h1>
        </header>
        <nav>
           
        </nav>
        <main>   
            <div class="container week">
                <div class="item" style="visibility: hidden;"></div>
                <div class="item">Monday</div>
                <div class="item">Tuesday</div>
                <div class="item">Wednesday</div>
                <div class="item">Thursday</div>
                <div class="item">Friday</div>
                <div class="item">Saturday</div>
                <div class="item">Sunday</div>
                <div class="item">Lunch</div>
                <div class="item main" id="main1" onclick="handleWeekClick(this)" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                <div class="item main" id="main2" onclick="handleWeekClick(this)" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                <div class="item main" id="main3" onclick="handleWeekClick(this)" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                <div class="item main" id="main4" onclick="handleWeekClick(this)" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                <div class="item main" id="main5" onclick="handleWeekClick(this)" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                <div class="item main" id="main6" onclick="handleWeekClick(this)" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                <div class="item main" id="main7" onclick="handleWeekClick(this)" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                <div class="item">Dinner</div>
                <div class="item main" id="main8" onclick="handleWeekClick(this)" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                <div class="item main" id="main9" onclick="handleWeekClick(this)" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                <div class="item main" id="main10" onclick="handleWeekClick(this)" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                <div class="item main" id="main11" onclick="handleWeekClick(this)" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                <div class="item main" id="main12" onclick="handleWeekClick(this)" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                <div class="item main" id="main13" onclick="handleWeekClick(this)" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                <div class="item main" id="main14" onclick="handleWeekClick(this)" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                
            
            </div>
            <p class="infotext">Drag dishes into calendar. Click on added dishes to delete them</p>
            <div class="maincontainer">
            <div class="container menu" id="menu">
            </div>
           
           
            </div>
            <button class="newDishBtn" onclick="openAddDishForm()">Add New Dish</button>
            <div id="AddNewDishForm">
            <form class="addDishes">
                Dish name: <input type="text" name="item" placeholder="new dish?" required>
                Ingredients: <input type="text" name="ingredient" placeholder="add ingredient" required>
                <button id="addIngredient">+</button>
                <div class="ingredients" id="ingredientsToAdd"></div>
                <button id="newDish">ADD</button>
            
            </form>
            </div>
            <div id="shoppingListContainer">shopping list:<div id="shoppingList"></div>
            </div>
        </main>

        </div>  


    <script>
        var thingToDrag = "";
        var ingredientsToAdd = [];
        var ingredientsToShop = [];
        
        let defaultDishes = [
                        {name: "Falafel",
                        ingredients: [
                                    "cheekpeas", 
                                    "persil", 
                                    "coriander", 
                                    "pita bread", 
                                    "yoghurt sauce"],
                        image: "falafel.jpg"            
                        },
                        {name: "empanadas",
                        ingredients: [
                                    "dough", 
                                    "tuna", 
                                    "potatoes", 
                                    "onions",
                                    "olives"],
                        image: "empanadas.jpg"

                        },
                        {name:"cuban rice",
                        ingredients: [
                                      "rice",
                                      "bananas",
                                      "eggs",
                                      "sausages"],
                        image: "cuban.jpg"
                        },
                        {name:"pasta",
                        ingredients: [
                                      "noodles",
                                      "tomatoes",
                                      "garlic",
                                      "cheese"
                        ],
                        image: "noodles.jpg"
                        },
                        ];
                        
        function getDishes(){
            if (localStorage.getItem("dishes")===null){
            return defaultDishes.slice();
            }      
            return JSON.parse(localStorage.getItem("dishes"));   
        
      }
     
        function populateMenu() {
            const dishes = getDishes();         
            dishes.forEach(function(d) {
                var dish = d.name
                var ings = d.ingredients;
                var image = d.image;
                var food = document.createElement("div");
                food.classList.add("item");
                food.innerHTML = ` 
                        <img src=${image} alt=${dish} style=\"width: 100%; height: 100%\">
                        <p class=\"centered\" draggable=\"true\" ondragstart=\"drag(this)\">${dish}</p>
                        <div class=\"ingredientsList\" id=\"${dish}\"></div>
                        `;
                document.getElementById("menu").appendChild(food);
                document.getElementById(dish).innerHTML = ings.join(", ");
               
                 
                }
                
            );
            localStorage.setItem("dishes", JSON.stringify(dishes));
        }

        function handleWeekClick(e){
            const content = e.textContent;
            var dishes = JSON.parse(localStorage.getItem("dishes"));
            var x = search(e.textContent, dishes);
            var arr = x.ingredients;
            arr.forEach((e) => {
                for( var i = 0; i < ingredientsToShop.length; i++)
                { if ( ingredientsToShop[i] === e) { ingredientsToShop.splice(i, 1); }}
            });
            let unique = [...new Set(ingredientsToShop)];
            document.querySelector("#shoppingList").innerHTML = unique.join(", ");

        
        if (e.innerHTML !== ""){
            e.innerHTML = "";
        }
      }
      
        function allowDrop(e) {
            e.preventDefault();
            }

        function drag(e) {
            thingToDrag = e.innerHTML
            var dishes = JSON.parse(localStorage.getItem("dishes"));
            var x = search(e.textContent, dishes);
            var arr = x.ingredients;
            arr.forEach((e) => ingredientsToAdd.push(e));
        }

        function search(nameKey, myArray){
                for (var i=0; i < myArray.length; i++) {
                    if (myArray[i].name === nameKey) {
                    return myArray[i];
                    }
                }
            }

        function drop(e) {
            e.preventDefault();
            document.getElementById(e.target.id).innerHTML = thingToDrag;
            ingredientsToAdd.forEach((i) => ingredientsToShop.push(i));
            ingredientsToAdd = [];
            let unique = [...new Set(ingredientsToShop)];
            document.querySelector("#shoppingList").innerHTML = unique.join(", ");
            }

        function addIngredient(e){
          e.preventDefault();
          const ingredient = (document.querySelector('[name=ingredient]')).value;
          ingredientsToAdd.push(ingredient);
          var ing = document.createElement("p");
          ing.innerHTML = ingredient;
          document.getElementById("ingredientsToAdd").appendChild(ing);
         
        }

        function addDish(e){
          e.preventDefault();
          let objectToadd = {
              name: (document.querySelector('[name=item]')).value,
              ingredients:ingredientsToAdd
          }    
          var dis = JSON.parse(localStorage.getItem("dishes"));
          dis.push(objectToadd);
          localStorage.setItem("dishes", JSON.stringify(dis));
          document.getElementById("menu").innerHTML = "";
          populateMenu();
          document.getElementById("ingredientsToAdd").innerHTML = "";
          ingredientsToAdd = [];
        }
        function openAddDishForm(){
            console.log("OPENING");
            document.getElementById("AddNewDishForm").style = "display:block; position:absolute";
        }

        document.getElementById("addIngredient").addEventListener('click', addIngredient);
        document.getElementById("newDish").addEventListener('click', addDish)
        populateMenu();
      
    </script>    
    </body>
    