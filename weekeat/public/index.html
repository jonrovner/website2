<html>
    <head>
        <title>what we eat</title>    
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Amatic+SC:wght@700&family=Open+Sans:wght@200&display=swap" rel="stylesheet"> 
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <style type = "text/css" media = "all">

        body{
            box-sizing: border-box;
            margin: 0px;
            padding: 0px;
        }
        #wrapper{
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        .infotext {
            font-family: 'Open Sans', sans-serif;
            font-style: italic;
            font-weight: lighter;
            font-size: small;
            margin-left: 2em;
        }
        .title{
            display: grid;
            font-family: 'Amatic SC', cursive;
            margin-bottom: 2rem;
            justify-items: center;
        }
        .week{
            margin-left: 2em;
            margin-right: 2em;
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            grid-template-rows: 25px 50px 50px; 
            row-gap: 0.5rem;
            column-gap: 0.5rem;
            
        }    
        
        
        .item {
            position: relative;
            font-family: 'Amatic SC', cursive;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.2), 0 2px 5px 0 rgba(0, 0, 0, 0.19);
            border-radius: 0.3rem;
            display: grid;
            align-content: center;
            justify-content: center;
        }

        .menu{
            margin-left: 2em;
            margin-right: 2em;
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;    
            row-gap: 1rem;
            column-gap: 1rem;
            justify-content: center;
            
        }
        .menu button {
            border-style: hidden;
            position: relative;
            font-family: 'Amatic SC', cursive;
            font-size: larger;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.2), 0 2px 5px 0 rgba(0, 0, 0, 0.19);
            border-radius: 0.3rem;
            display: grid;
            align-content: center;
            justify-content: center;
        }

        .menuitem {
            max-width: 10rem;
            min-height: 5rem;
            position: relative;
            font-family: 'Amatic SC', cursive;
            box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.2), 0 2px 5px 0 rgba(0, 0, 0, 0.19);
            border-radius: 0.3rem;
            cursor: move;
            transition: all 0.3s;
            overflow: hidden;
        }

        .menuitem .dishTitle {
            font-size: large;
            padding-left: 1.3rem;
            padding-right: 1.3rem;
            padding-top: 0.3rem;
            padding-bottom: 0.3rem;
            background-color:black;
            color:white;
            border-radius: 1rem;
            transition: all 0.3s;
            letter-spacing: 0.1rem;
        }
        .menuitem img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 1rem;
            transition: all 0.3s;
        }
        .overed .dishTitle {
            transform: translate(-50%, -80%);
        }

        .centered {
            position: absolute;
            top: 25%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1;
        }

        .description {
            display: none;

        }

        .overed .description  {
            height: 300px;
            width: auto;
            margin-left: 1em;
            margin-right: 1em;
            margin-top: 1em;
            display: block;
            font-family: Arial, Helvetica, sans-serif;
            font-size: smaller;
            font-style: italic;
            background-color: white;
            color: black;
            overflow: visible;
            position: absolute;
            top: 50%;
            left: 50%;
            

        }
        .main:hover {
            background-color: pink;
        }
        
        .selected {
            background-color: lightcyan;
        }
        
        .ingredients{
            background-color: blanchedalmond;
            margin: 5px;
            min-height: 2em;
        }
        .ingredientsList{
            visibility: hidden;
            margin-left: 1em;
            font-family: Arial, Helvetica, sans-serif;
            font-style: italic;
            font-size: smaller;
            position: relative;
            background-color: #f1f1f1;
            min-width: 160px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            
        }

        #shoppingList{
            background-color: whitesmoke;
            min-height: 100px;
            margin: 0.5em;
            
        }
        .newDishBtn{
            align-items: flex-end;
            padding: 2em;
        } 

        .addDishes {
            display: none;
            max-width: 20rem;
            max-height: 30rem;
            background-color: cornsilk;
            margin: 1em;
            position: relative;
        }

        .visible { 
            
            font-family: Verdana, Geneva, Tahoma, sans-serif;
            font-size: small;
            display: flex;
            flex-direction: column;
            position: absolute;
            top: 25%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 2rem;
            z-index: 1;
            border-radius: 0.4rem;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
        }
        .visible input {
            font-family: 'Amatic SC', cursive;
            letter-spacing: 1px;
            border-radius: 0.5rem;
            padding: 0.2rem;
            border: hidden;

        }
        .visible button{
            border: hidden;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
        }
        .visible * {
            margin-top: 0.3rem;
            margin-bottom: 0.2rem;
            font-family: 'Open Sans', sans-serif;
            font-weight: lighter;
            font-size: small;
        }
        .visible a{
            border: 1px, solid, black;
            text-decoration: none;
            border-radius: 1em;
        }
        .close{
            border: 1px, solid, black;
            margin-left: 95%;
        }

        #shoppingListContainer{
            padding: 0.5rem;
            margin-top: 2rem;
            margin-left: 20%;
            margin-right: 20%;
            background-color: ivory;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            font-family: 'Open Sans', sans-serif;
            font-style: italic;
            font-size: smaller;
        }


        </style> 
    <body onload="">
       <div id="wrapper"> 
        <header>
            <h1 class="title">WeekEat</h1>
        </header>
        
        <main>   
            <div class="container week">
                <div class="item" style="visibility: hidden;"></div>
                <div class="item">Monday</div>
                <div class="item">Tuesday</div>
                <div class="item">Wednesday</div>
                <div class="item">Thursday</div>
                <div class="item">Friday</div>
                <div class="item">Saturday</div>
                <div class="item">Sunday</div>
                <div class="item">Lunch</div>
                <div class="item main" id="main1" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                <div class="item main" id="main2" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                <div class="item main" id="main3" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                <div class="item main" id="main4" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                <div class="item main" id="main5" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                <div class="item main" id="main6" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                <div class="item main" id="main7" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                <div class="item">Dinner</div>
                <div class="item main" id="main8" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                <div class="item main" id="main9" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                <div class="item main" id="main10" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                <div class="item main" id="main11" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                <div class="item main" id="main12" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                <div class="item main" id="main13" ondrop="drop(event)" ondragover="allowDrop(event)"></div>
                <div class="item main" id="main14" ondrop="drop(event)" ondragover="allowDrop(event)"></div>    
            </div>
            <p class="infotext">Drag dishes into calendar. Click on added dishes to delete</p>
            <div class="maincontainer">
            <div class="menu" id="menu">
            </div>         
            </div>
            
            <form class="addDishes">
                <a href="" class="close" onclick="closeAddForm">X</a>
                Dish name: <input type="text" name="item" placeholder="dish name" required></input>
                Description: <textarea name="desc"></textarea>
                Ingredients: <input type="text" name="ingredient" placeholder="ingredient name" required></input>
                <button id="addIngredient">+</button>
                <div class="ingredients" id="ingredientsToAdd"></div>
                image url: <input type="text" name="src" placeholder="image url"></input>
                
                
                <button id="newDish">ADD</button>
            </form>
            
            <div id="shoppingListContainer">shopping list:<div id="shoppingList"></div>
            </div>
        </main>
        </div>
    

              
    <script>
        var thingToDrag = "";
        var ingredientsToAdd = [];
        var ingredientsToShop = [];
        
        const defaultDishes = [
                        {name: "Falafel",
                        desc: "Fryed balls of Soaked cheekpeas, grounded with persil, garlic and coriander, served in a pita bread, with fresh veggies (letuce, tomato, cabbage, cucumber) topped with mint yoghurt sauce",
                        ingredients: [
                                    "cheekpeas", 
                                    "persil", 
                                    "coriander", 
                                    "pita bread", 
                                    "yoghurt sauce"],
                        image: "img/falafel.jpg"            
                        },
                        {name: "empanadas",
                        desc: "Baked turnover filled with tuna, onions, potatoes and olives",
                        ingredients: [
                                    "dough", 
                                    "tuna", 
                                    "potatoes", 
                                    "onions",
                                    "olives"],
                        image: "img/empanadas.jpg"

                        },
                        {name:"cuban rice",
                        desc:"White rice with fried bananas, egg and susage",
                        ingredients: [
                                      "rice",
                                      "bananas",
                                      "eggs",
                                      "sausages"],
                        image: "img/cuban.jpg"
                        },
                        {name:"pasta",
                        desc: "no need for description here. Plain old italian pasata with tomato sause and cheese",
                        ingredients: [
                                      "noodles",
                                      "tomatoes",
                                      "garlic",
                                      "cheese"
                        ],
                        image: "img/noodles.jpg"
                        },
                        {name:"milanesas",
                        desc:"breaded beef with potatoes",
                        ingredients: [
                            "beef",
                            "bread",
                            "eggs",
                            "garlic",
                            "potatoes"
                            ],
                        image: "img/mila.jpg"
                        },
                        {name:"hamburguesas",
                        desc:"clasic hamburguer",
                        ingredients:["pattys", "buns", "tomato", "onion", "bacon", "pckles"],
                        image: "img/burguer.jpg"

                        },
                        {name:"baked beef",
                        desc: "baked beef",
                        ingredients: ["beef", "onions", "potatoes", "sweet potatoes"],
                        image: "img/carnehorno.jpg"

                        },
                        {name: "baked chicken",
                        desc: "good old baked chicken with potatoes",
                        ingredients: ["chicken", "potatoes"],
                        image: "img/parripollo.jpg"

                        }
                        ];
                        
        function getDishes(){
            if (localStorage.getItem("dishes")===null){
            return defaultDishes.slice();
            }      
            return JSON.parse(localStorage.getItem("dishes"));
        }
     
        function populateMenu() {
            const dishes = getDishes();         
            dishes.forEach(function(d) {
                var dish = d.name
                var ings = d.ingredients;
                var image = d.image;
                var desc = d.desc;
                var food = document.createElement("div");
                food.classList.add("menuitem");
                food.innerHTML = ` 
                        <img src=${image} alt=${dish} onmouseover=\"handleMouseOver(this)\">
                        <p class=\"dishTitle centered\" draggable=\"true\" ondragstart=\"drag(this)\">${dish}</p>
                        <div class=\"description\">${desc}</div>
                        <div class=\"ingredientsList\" id=\"${dish}\"></div>
                        `;
                $('#menu').append(food);
                document.getElementById(dish).innerHTML = ings.join(", ");
                });
            var btn = "<button class=\"newDishBtn\" onclick=\"openAddDishForm()\">Create Dish</button>";
            $('#menu').append(btn);
            $('.menuitem').on('mouseleave', handleMouseLeave);
            localStorage.setItem("dishes", JSON.stringify(dishes));
        }
        
        function handleMouseOver(e){
            e.parentElement.classList.add("overed");    
        }
        
        function handleMouseLeave(e){
            e.currentTarget.classList.remove("overed");
        }

        function handleWeekClick(e){
           
            const content = e.currentTarget.textContent;
            var dishes = JSON.parse(localStorage.getItem("dishes"));
            var x = search(e.currentTarget.textContent, dishes);
            var arr = x.ingredients;
            arr.forEach((e) => {
                for( var i = 0; i < ingredientsToShop.length; i++)
                { if ( ingredientsToShop[i] === e) { ingredientsToShop.splice(i, 1); }}
            });
            let unique = [...new Set(ingredientsToShop)];
            document.querySelector("#shoppingList").innerHTML = unique.join(", ");

            if (e.currentTarget.textContent !== ""){
                e.currentTarget.textContent = "";
            }
        }
      
        function allowDrop(e) {
            e.preventDefault();
            }

        function drag(e) {
            thingToDrag = e.innerHTML
            var dishes = JSON.parse(localStorage.getItem("dishes"));
            var x = search(e.textContent, dishes);
            var arr = x.ingredients;
            arr.forEach((e) => ingredientsToAdd.push(e));
        }

        function search(nameKey, myArray){
                for (var i=0; i < myArray.length; i++) {
                    if (myArray[i].name === nameKey) {
                    return myArray[i];
                    }
                }
            }

        function drop(e) {
            e.preventDefault();
            document.getElementById(e.target.id).innerHTML = thingToDrag;
            ingredientsToAdd.forEach((i) => ingredientsToShop.push(i));
            ingredientsToAdd = [];
            let unique = [...new Set(ingredientsToShop)];
            document.querySelector("#shoppingList").innerHTML = unique.join(", ");
            }

        function addIngredient(e){
          e.preventDefault();
          const ingredient = (document.querySelector('[name=ingredient]')).value;
          ingredientsToAdd.push(ingredient);
          var ing = document.createElement("p");
          ing.innerHTML = ingredient;
          document.getElementById("ingredientsToAdd").appendChild(ing);
          document.querySelector('[name=ingredient]').value= "";
         
        }

        function addDish(e){
          e.preventDefault();
          let image = (document.querySelector('[name=src]')).value || "https://picsum.photos/200/300?random=4";
          let objectToadd = {
              name: (document.querySelector('[name=item]')).value,
              ingredients:ingredientsToAdd,
              desc: (document.querySelector('[name=desc]')).value,
              image: image
          };   
          var dishes = JSON.parse(localStorage.getItem("dishes"));
          dishes.push(objectToadd);
          localStorage.setItem("dishes", JSON.stringify(dishes));
          document.getElementById("menu").innerHTML = "";
          populateMenu();
          document.getElementById("ingredientsToAdd").innerHTML = "";
          ingredientsToAdd = [];
          $('.addDishes').removeClass("visible");
          $('.addDishes').reset();
        }

        function openAddDishForm(){
            $('.addDishes').addClass("visible");
        }

        function closeAddForm(){
        $('.addDishes').removeClass("visible");
        }

        populateMenu();
        $('#addIngredient').on('click', addIngredient);
        $('#newDish').on('click', addDish); 
        $('.menuitem').on('mouseleave', handleMouseLeave);
        $('.main').on('click', handleWeekClick);
      
    </script>    
    </body>
    